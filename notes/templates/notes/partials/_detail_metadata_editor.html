{% load tag_colors %}
<div id="note-metadata-block" class="mt-2 bg-gray-800/50 rounded-lg border border-blue-600/50 p-4">
    <form hx-post="{% url 'notes:inline_edit_metadata' note.pk %}"
          hx-target="#note-metadata-block" hx-swap="outerHTML">
        {% csrf_token %}
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
            <div>
                <label class="block text-xs font-medium text-gray-400 mb-1">Type</label>
                <select name="note_type"
                        class="w-full rounded-md border-gray-600 bg-gray-700 text-gray-200 text-sm px-2 py-1.5 focus:border-blue-500 focus:ring-blue-500">
                    {% for val, label in note_types %}
                    <option value="{{ val }}" {% if val == note.note_type %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-400 mb-1">Folder</label>
                <select name="folder"
                        class="w-full rounded-md border-gray-600 bg-gray-700 text-gray-200 text-sm px-2 py-1.5 focus:border-blue-500 focus:ring-blue-500">
                    <option value="">No folder</option>
                    {% for folder in folders %}
                    <option value="{{ folder.pk }}" {% if note.folder_id == folder.pk %}selected{% endif %}>{{ folder.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="flex items-center gap-2 text-xs font-medium text-gray-400 mt-4 cursor-pointer">
                    <input type="checkbox" name="is_pinned" value="1" {% if note.is_pinned %}checked{% endif %}
                           class="rounded border-gray-600 bg-gray-700 text-yellow-500 focus:ring-yellow-500 focus:ring-offset-0">
                    Pinned
                </label>
            </div>
        </div>
        {% if all_tags %}
        <div class="mt-3">
            <label class="block text-xs font-medium text-gray-400 mb-1">Tags</label>
            <div class="flex flex-wrap gap-1.5">
                {% for tag in all_tags %}
                {% tag_classes tag.color as tc %}
                <label class="cursor-pointer">
                    <input type="checkbox" name="tags" value="{{ tag.pk }}"
                           {% if tag.pk in current_tag_pks %}checked{% endif %}
                           class="hidden"
                           onchange="toggleMetaTagPill(this, '{{ tc.bg }}', '{{ tc.text }}', '{{ tc.border }}')">
                    <span class="meta-tag-pill inline-flex items-center text-xs px-2 py-0.5 rounded-full border transition-colors
                                 {% if tag.pk in current_tag_pks %}{{ tc.bg }} {{ tc.text }} {{ tc.border }}{% else %}border-gray-600 text-gray-500 hover:text-gray-300 hover:border-gray-500{% endif %}"
                          data-active-bg="{{ tc.bg }}" data-active-text="{{ tc.text }}" data-active-border="{{ tc.border }}">
                        #{{ tag.name }}
                    </span>
                </label>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        <div class="flex gap-2 mt-3">
            <button type="submit" class="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded-md transition-colors">Save</button>
            <button type="button"
                    hx-get="{% url 'notes:inline_edit_metadata' note.pk %}?display=1"
                    hx-target="#note-metadata-block" hx-swap="outerHTML"
                    class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 text-sm font-medium rounded-md transition-colors">Cancel</button>
        </div>
    </form>
</div>
<script>
function toggleMetaTagPill(checkbox, bgClass, textClass, borderClass) {
    var span = checkbox.nextElementSibling;
    if (checkbox.checked) {
        span.classList.add(...bgClass.split(' '), ...textClass.split(' '), ...borderClass.split(' '));
        span.classList.remove('border-gray-600', 'text-gray-500');
    } else {
        span.classList.remove(...bgClass.split(' '), ...textClass.split(' '), ...borderClass.split(' '));
        span.classList.add('border-gray-600', 'text-gray-500');
    }
}
</script>
